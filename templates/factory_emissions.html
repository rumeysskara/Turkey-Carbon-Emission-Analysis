<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Türkiye'deki Fabrikaların Karbon Emisyonu Analizi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .emissions-chart {
            height: 400px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-success">
        <div class="container">
            <a class="navbar-brand" href="/">Türkiye Karbon Emisyon Analizi</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Ana Sayfa</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/factory-emissions">Fabrika Emisyonları</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/all-turkey-emissions">Tüm Türkiye Analizi</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/carbon-predictions">Emisyon Tahminleri</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="jumbotron bg-light p-4 rounded">
            <h1 class="display-5">Türkiye'deki Fabrikaların Karbon Emisyonu Analizi</h1>
            <p class="lead">Bu sayfa, Türkiye'deki fabrikaların <strong>yıllık</strong> karbon emisyonlarını analiz eder ve görselleştirir.</p>
            <p>Tüm emisyon değerleri ton CO2 eşdeğeri (CO2e) olarak ifade edilmektedir ve yıllık bazda hesaplanmıştır.</p>
            <hr class="my-4">
        </div>

        <!-- Özet Bilgiler -->
        <div class="row mt-4">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">Analiz Edilen Fabrika Sayısı</h5>
                        <p class="display-4" id="total-factory-count">0</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">Toplam Yıllık Karbon Emisyonu</h5>
                        <p class="display-4" id="total-emissions">0</p>
                        <p class="text-muted">ton CO2e/yıl</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">Fabrika Başına Ortalama Emisyon</h5>
                        <p class="display-4" id="avg-emissions">0</p>
                        <p class="text-muted">ton CO2e/fabrika/yıl</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Grafikler -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        Bölgelere Göre Yıllık Emisyonlar
                    </div>
                    <div class="card-body">
                        <canvas id="regions-chart" class="emissions-chart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        Fabrika Türlerine Göre Yıllık Emisyonlar
                    </div>
                    <div class="card-body">
                        <canvas id="factory-types-chart" class="emissions-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fabrika Listesi -->
        <div class="card mt-4">
            <div class="card-header bg-success text-white">
                Fabrika Listesi ve Yıllık Emisyonları
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> Aşağıdaki tabloda fabrikaların yıllık karbon emisyon değerleri ton CO2e cinsinden gösterilmektedir.
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-success">
                            <tr>
                                <th>Fabrika Adı</th>
                                <th>Bölge</th>
                                <th>Tür</th>
                                <th>Boyut (m²)</th>
                                <th class="text-center">Yıllık Emisyon (ton CO2e)</th>
                            </tr>
                        </thead>
                        <tbody id="factories-table">
                            <!-- Fabrika verileri JavaScript ile doldurulacak -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-4">
        <p>Türkiye Karbon Emisyon Analizi by Rumeysa Kara</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Fabrika emisyon verilerini yükle
        fetch('/static/data/factory_emissions.json')
            .then(response => response.json())
            .then(data => {
                displayFactoryData(data);
            })
            .catch(error => {
                console.error('Veri yükleme hatası:', error);
            });
        
        function displayFactoryData(data) {
            // Özet bilgileri göster
            document.getElementById('total-factory-count').textContent = data.total_factory_count;
            document.getElementById('total-emissions').textContent = data.total_annual_emissions_ton.toLocaleString('tr-TR');
            document.getElementById('avg-emissions').textContent = data.average_annual_emissions_ton.toLocaleString('tr-TR', {maximumFractionDigits: 1});
            
            // Grafikleri oluştur
            createRegionsChart(data);
            createFactoryTypesChart(data);
            
            // Fabrika tablosunu doldur
            populateFactoriesTable(data);
        }
        
        function createRegionsChart(data) {
            // Bölgelere göre emisyon verileri
            const regions = data.region_results.map(region => region.region);
            const emissions = data.region_results.map(region => region.total_annual_emissions_ton);
            
            // Grafik oluştur
            const ctx = document.getElementById('regions-chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: regions,
                    datasets: [{
                        label: 'Yıllık Emisyon (ton CO2e)',
                        data: emissions,
                        backgroundColor: 'rgba(40, 167, 69, 0.7)',
                        borderColor: 'rgba(40, 167, 69, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Yıllık Emisyon (ton CO2e)'
                            }
                        }
                    }
                }
            });
        }
        
        function createFactoryTypesChart(data) {
            // Fabrika türlerine göre verileri topla
            const factoryTypes = {};
            
            data.region_results.forEach(region => {
                region.factories.forEach(factory => {
                    const type = factory.type;
                    if (!factoryTypes[type]) {
                        factoryTypes[type] = 0;
                    }
                    factoryTypes[type] += factory.annual_emissions_ton;
                });
            });
            
            // Grafik verilerini hazırla
            const types = Object.keys(factoryTypes);
            const emissions = Object.values(factoryTypes);
            
            // Grafik oluştur
            const ctx = document.getElementById('factory-types-chart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: types,
                    datasets: [{
                        data: emissions,
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.7)',
                            'rgba(255, 193, 7, 0.7)',
                            'rgba(220, 53, 69, 0.7)',
                            'rgba(0, 123, 255, 0.7)',
                            'rgba(111, 66, 193, 0.7)'
                        ],
                        borderColor: [
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(220, 53, 69, 1)',
                            'rgba(0, 123, 255, 1)',
                            'rgba(111, 66, 193, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
        
        function populateFactoriesTable(data) {
            const tableBody = document.getElementById('factories-table');
            
            // Tüm fabrikaları topla
            const factories = [];
            data.region_results.forEach(region => {
                region.factories.forEach(factory => {
                    factories.push({
                        ...factory,
                        region: region.region
                    });
                });
            });
            
            // Emisyona göre sırala (yüksekten düşüğe)
            factories.sort((a, b) => b.annual_emissions_ton - a.annual_emissions_ton);
            
            // Tabloyu doldur
            factories.forEach((factory, index) => {
                const row = document.createElement('tr');
                
                // Emisyon değerine göre renk sınıfı belirle
                let emissionClass = '';
                if (factory.annual_emissions_ton > 1000) {
                    emissionClass = 'text-danger fw-bold';
                } else if (factory.annual_emissions_ton > 500) {
                    emissionClass = 'text-warning fw-bold';
                } else {
                    emissionClass = 'text-success fw-bold';
                }
                
                row.innerHTML = `
                    <td>${index + 1}. ${factory.name}</td>
                    <td>${factory.region}</td>
                    <td>${factory.type}</td>
                    <td>${factory.size_m2.toLocaleString('tr-TR')}</td>
                    <td class="text-center ${emissionClass}">${factory.annual_emissions_ton.toLocaleString('tr-TR')}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
    </script>
</body>
</html>
